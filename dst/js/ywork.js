(function(e){var t=t||{},i=false,n="",a;if(typeof dd=="object"){i="dd"}else if(typeof wx=="object"){i="wx"}var o=function(){var e="",t=0,i="ywork.js",a="../css/ywork.css",o=document.getElementsByTagName("link"),r=document.getElementsByTagName("script");n=r[r.length-1].getAttribute("src");if(n.indexOf(i)==-1){for(var c=0;c<r.length;c++){var l=r[c].src;if(typeof l!="undefined"&&l.indexOf(i)!=-1){l=l.substring(0,l.indexOf(i));n=l;break}}}n=n.substring(0,n.indexOf(i));var s=n+a;for(var c=0;c<o.length;c++){e=o[c].getAttribute("href");if(e.indexOf(s)!=-1){t++;break}}if(t==0){headTag=document.getElementsByTagName("head")[0];o=document.createElement("link");o.setAttribute("rel","stylesheet");o.setAttribute("href",s);headTag.appendChild(o)}};o();var r=function(e,t,i){if(document.getElementById(e)==undefined){var n=document.createElement("div");n.innerHTML=t;n.setAttribute("id",e);document.getElementsByTagName("body")[0].appendChild(n);if(typeof i=="function"){i(n)}}};t.includeJs=function(e){var e=e||{},t=e.url,i=document.createElement("script"),n=document.getElementsByTagName("head")[0];i.type="text/javascript";i.src=t;n.appendChild(i);if(i.readyState){i.onreadystatechange=function(){if(i.readyState=="loaded"||i.readyState=="complete"){i.onreadystatechange=null;if(typeof e.succ=="function"){e.succ()}}}}else{i.onload=function(){if(typeof e.succ=="function"){e.succ()}}}};t.log=function(){if(typeof window.leoType=="undefined"){return}var e=arguments[0];if(window.leoType==0){var t=arguments[1];if(typeof t!="undefined"){alert(e+":"+JSON.stringify(t));return}if(typeof e=="object"){alert(JSON.stringify(e))}else{alert(e)}return}if(arguments.length==2){var i=arguments[1];console.group&&console.group(e);console.info(i);console.groupEnd&&console.groupEnd()}if(arguments.length==1){if(typeof e=="object"){console.info(e);return}if(e==""){console.error("传入参数为空");return}console.log("%c"+e,"color:red")}};t.ajax=function(e){var i={async:true,contentType:"application/json; charset=utf-8",jsonForce:true};if(Object.prototype.toString.call(e)=="[object Object]"){for(var n in e){i[n]=e[n]}}var a=function(){try{o=new XMLHttpRequest;a=function(){return new XMLHttpRequest}}catch(e){try{o=new ActiveXObject("Msxml2.XMLHTTP");a=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(e){try{o=new ActiveXObject("Microsoft.XMLHTTP");a=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(e){o=null;a=function(){return null}}}}return o};var o=a();var r=function(e,n,a){var r=setTimeout(function(){t.showLoading()},300);o.onreadystatechange=function(){if(o.readyState==4){for(var e=0,n=c.alwaysCallbacks.length;e<n;e++){c.alwaysCallbacks[e](o.responseText,o)}var a;try{a=JSON.parse(o.responseText||null)}catch(l){a=undefined}var s=o.status;if(s<200||s>=300&&s!=304||i.jsonForce&&typeof a==="undefined"){clearTimeout(r);t.hideLoading();for(var e=0,n=c.errCallbacks.length;e<n;e++){c.errCallbacks[e](o.responseText,o)}}else{clearTimeout(r);t.hideLoading();for(var e=0,n=c.sucCallbacks.length;e<n;e++){c.sucCallbacks[e](a,o)}}}};o.open(a,e,i.async);a==="POST"&&o.setRequestHeader("Content-Type",i.contentType);o.send(n||null)};var c={sucCallbacks:[],errCallbacks:[],alwaysCallbacks:[],options:i,get:function(e,t){r(e,t,"GET");return c},post:function(e,t){r(e,t,"POST");return c}};c.headers=function(e){if(Object.prototype.toString.call(e)==="[object Object]"){for(var t in e){console.log(t+" "+e[t]);console.log(o);o.setRequestHeader(t,e[t])}}};c.before=function(e){typeof e==="function"&&e(o);return c};c.succ=function(e){typeof e==="function"&&c.sucCallbacks.push(e);return c};c.fail=function(e){typeof e==="function"&&c.errCallbacks.push(e);return c};c.always=function(e){typeof e==="function"&&c.alwaysCallbacks.push(e);return c};return c};t.alert=function(e){var e=e||{},t=e.text||"系统繁忙，请稍候再试",i=e.title||"",n="<div class=weui_dialog_alert><div class=weui_mask></div><div class=weui_dialog><div class=weui_dialog_hd><strong class=weui_dialog_title>"+i+"</strong></div><div class=weui_dialog_bd>"+t+'</div><div class=weui_dialog_ft><a href="javascript: void(0);" class="weui_btn_dialog primary">确定</a></div></div></div>';r("ywork-jsapi-alert",n,function(e){var t=document.getElementsByClassName("weui_btn_dialog primary")[0];t.onclick=function(){e.parentNode.removeChild(e)}})};t.confirm=function(e){var e=e||{},t=e.title||"",i=e.text||"",n=e.confirmText||"确定",a=e.cancelText||"忽略",o=e.confirmColor||"#0BB20C",c=e.cancelColor||"#353535",l="<div class=weui_dialog_confirm><div class=weui_mask></div><div class=weui_dialog><div class=weui_dialog_hd><strong class=weui_dialog_title>"+t+"</strong></div><div class=weui_dialog_bd>"+i+'</div><div class=weui_dialog_ft><a href="javascript:void(0);" class="weui_btn_dialog default" style="color: '+c+'">'+a+'</a><a href="javascript:void(0);" class="weui_btn_dialog primary" style="color: '+o+'">'+n+"</a></div></div></div>";r("ywork-jsapi-confirm",l,function(t){var i=document.getElementsByClassName("weui_btn_dialog primary")[0],n=document.getElementsByClassName("weui_btn_dialog default")[0];i.onclick=function(){t.parentNode.removeChild(t);if(typeof e.succ=="function"){e.succ()}};n.onclick=function(){t.parentNode.removeChild(t);if(typeof e.fail=="function"){e.fail()}}})};t.toast=function(e){var e=e||{},t=e.text||"系统繁忙<br>请稍候再试",i=e.icon?"weui_icon_toast":"weui_icon_toast_error",n=e.duration||900,a="<div  class=toast><div class=weui_mask_transparent></div><div class=weui_toast><i class="+i+"></i><p class=weui_toast_content>"+t+"</p></div></div>";r("ywork-jsapi-toast",a,function(e){setTimeout(function(){e.parentNode.removeChild(e)},n)})};t.showLoading=function(e){var e=e||{},t=e.text||"数据加载中",i='<div class=weui_loading_toast><div class=weui_mask_transparent></div><div class=weui_toast><div class=weui_loading><div class="weui_loading_leaf weui_loading_leaf_0"></div><div class="weui_loading_leaf weui_loading_leaf_1"></div><div class="weui_loading_leaf weui_loading_leaf_2"></div><div class="weui_loading_leaf weui_loading_leaf_3"></div><div class="weui_loading_leaf weui_loading_leaf_4"></div><div class="weui_loading_leaf weui_loading_leaf_5"></div><div class="weui_loading_leaf weui_loading_leaf_6"></div><div class="weui_loading_leaf weui_loading_leaf_7"></div><div class="weui_loading_leaf weui_loading_leaf_8"></div><div class="weui_loading_leaf weui_loading_leaf_9"></div><div class="weui_loading_leaf weui_loading_leaf_10"></div><div class="weui_loading_leaf weui_loading_leaf_11"></div></div><p class=weui_toast_content>'+t+"</p></div></div>";r("ywork-jsapi-showLoading",i)};t.hideLoading=function(){var e=document.getElementById("ywork-jsapi-showLoading");e&&e.parentNode.removeChild(e)};t.actionSheet=function(e){var e=e||{},t=e.itemList,i="",n=function(t){if(typeof e.succ=="function"){e.succ(t)}},a=function(t){if(typeof e.fail=="function"){e.fail(t)}};if(typeof t=="undefined"||!t instanceof Array||t.length==0){console.error("check your array");return}for(var o=0;o<t.length;o++){i+="<div data-index="+o+' class="weui_actionsheet_cell item">'+t[o]+"</div>"}var c='<div class="weui_mask_transition weui_fade_toggle"></div><div class="weui_actionsheet weui_actionsheet_toggle"><div class="weui_actionsheet_menu">'+i+'</div><div class="weui_actionsheet_action"><div class="weui_actionsheet_cell cancel_btn">取消</div></div></div>';r("ywork-jsapi-actionsheet",c,function(e){var t=document.getElementsByClassName("weui_mask_transition")[0],i=document.getElementsByClassName("weui_actionsheet_cell cancel_btn")[0],o=document.getElementsByClassName("weui_actionsheet_cell item");t.style.display="block";t.onclick=function(){e.parentNode.removeChild(e);a(-1)};i.onclick=function(){e.parentNode.removeChild(e);a(-1)};if(o&&o.length>0){for(var r=0;r<o.length;r++){o[r].onclick=function(){e.parentNode.removeChild(e);n(parseInt(this.getAttribute("data-index")))}}}})};t.updateShow=function(e){var e=e||{},t=e.title||"",i=e.text||"",n=e.image?'<img src=" '+e.image+' "  class=weui_dialog_img  />':"",a=e.buttonText||"我知道了",o="<div class=weui_dialog_confirm><div class=weui_mask></div><div class=weui_dialog><div class=weui_dialog_hd>"+n+"<h3>"+t+"</h3><div class=weui_dialog_bd>"+i+'</div></div><div class=weui_dialog_ft><a href="javascript:void(0);" class="weui_btn_dialog primary">'+a+"</a></div></div></div>";r("ywork-jsapi-updateShow",o,function(e){var t=document.getElementsByClassName("weui_btn_dialog primary")[0];t.onclick=function(){e.parentNode.removeChild(e)}})};t.avatar=function(e){var e=e||{},t=e.name||"",i=e.size||90,n=e.font||"36px 微软雅黑";function a(e){return e.match(/^([a-zA-Z]|\s|,|\.)+$/)!==null}var o=["#78c06e","#f65e8d","#f6bf26","#f65e5e","#5e97f6","#9a89b9","#a1887f","#ff943e","#5ec9f6","#3bc2b5","#5c6bc0","#bd84cd","#6bb5ce","#c5cb63","#ff8e6b","#78919d"];var r=o.length;var c={getAvatar:function(e){var e=this._getShowName(e);var t=this._getColor(e);return{name:e,color:t}},_getShowName:function(e){var t=e||"",i=[];if(a(t)){t=t.replace(/,|\./g," ").replace(/\s+/g," ");i=t.split(" ");if(i.length===1){return t.slice(0,2)}return i[0].slice(0,1)+i[1].slice(0,1)}return t.replace(/,|\.|\s+/g,"").slice(-2)},_getColor:function(e){var t=0;for(char in e){t+=e.charCodeAt(char)}return o[t%r]}};function l(e,t,i){var n=c.getAvatar(e),t=t,i=i,a=document.createElement("canvas"),o=a.getContext("2d");a.width=a.height=t;o.rect(0,0,t,t);o.fillStyle=n.color;o.fill();o.font=i;o.textBaseline="middle";o.textAlign="center";o.fillStyle="#fff";o.fillText(n.name,t/2,t/2);return a.toDataURL()}return l(t,i,n)};t.complexChoose=function(e){var i=e||{},n=e.ajaxURL,a=e.id||"",o=e.onlyDepartment||false,c=e.onlyUser||false,l=e.debug||false,s=e.succ||function(e){},d=e.fail||function(e){},u;if(!l&&typeof n=="undefined"){console.error("must be need ajaxURL");return}var f={calcSum:function(){var e=u.querySelector("#submit-btn"),t=u.querySelector("#submit-btn span"),i=u.querySelector("#checkall"),n=u.querySelectorAll(".b-flex > li").length;if(n<=0){e.disabled=true;t.innerHTML="";i.querySelector("i.g-check").className="g-check"}else{e.disabled=false;t.innerHTML="("+n+")"}},checkAllState:function(){var e=u.querySelectorAll("li[data-name] i.g-check"),t=u.querySelector("#checkall i.g-check"),i=true;for(var n=0;n<e.length;n++){if(e[n].className.indexOf("checked")==-1){i=false;break}}if(i){t.className="g-check checked"}else{t.className="g-check"}},checkDepartment:function(){var e=u.querySelectorAll('.dropdown-box li[data-type="1"]');for(var t=0;t<e.length;t++){var i="block";if(e[t].querySelector("i.g-check").className.indexOf("checked")!=-1){i="none"}e[t].querySelector("div.b-righticon").style.display=i}},_addBottomtUser:function(e,t,i,n){var a=document.createElement("li");a.setAttribute("data-id",e);a.setAttribute("data-name",t);a.setAttribute("data-type",n);a.innerHTML='<img src="'+i+'" class="linkman-box-img"><a class="g-add del-icon"></a>';u.querySelector("#select-user ul.b-flex").appendChild(a);this.calcSum();this.bind.delectUser()},_getPrimaryUser:function(){var e=u.querySelectorAll(".b-flex > li[data-id]");if(e.length>0){var t=[];for(var i=0;i<e.length;i++){var n={id:e[i].getAttribute("data-id"),name:e[i].getAttribute("data-name"),type:e[i].getAttribute("data-type"),avatar:e[i].querySelector("img").src};t.push(n)}return t}},_setPrimaryUser:function(e){if(!e||typeof e=="undefined"){return}var i=u.querySelectorAll("li[data-name]"),n=[];for(var a=0;a<e.length;a++){n.push(e[a].id)}for(var a=0;a<i.length;a++){var o=i[a].getAttribute("data-id");if(t.indexOfArray({array:n,value:o})!=-1){i[a].querySelector("i.g-check").className="g-check checked"}}for(var a=0;a<e.length;a++){var r=e[a].id,c=e[a].name||"",l=e[a].type||"",s=e[a].avatar||t.avatar({name:c});this._addBottomtUser(r,c,s,l)}f.checkDepartment()},bind:{preDepartment:function(){var e=u.querySelector("#preDepartment");if(e!=null){e.onclick=function(){var e=this.getAttribute("data-pid"),t=f._getPrimaryUser();g(e,t,true)}}},nextDepartmentFn:function(e){var t=e.getAttribute("data-id"),i=f._getPrimaryUser();g(t,i,true)},_selectFn:function(e){var i=e.getAttribute("data-id"),n=e.querySelector("i.g-check");if(n.className.indexOf("checked")!=-1){n.className="g-check";var a=u.querySelector('.b-flex li[data-id="'+i+'"]');a.parentNode.removeChild(a);f.calcSum()}else{n.className="g-check checked";var o=e.getAttribute("data-name")||"",r=e.getAttribute("data-type");if(e.querySelector("img")==null){var l=t.avatar({name:o})}else{var l=e.querySelector("img").src}f._addBottomtUser(i,o,l,r)}if(!c){f.checkDepartment()}f.checkAllState()},_bottomDelectFn:function(e){var t=e.getAttribute("data-id"),i=u.querySelector('li[data-id="'+t+'"] i.g-check');if(i!=null){i.className="g-check"}e.parentNode.removeChild(e);f.checkAllState();f.calcSum()},checkall:function(){u.querySelector("#checkall").onclick=function(){var e=this.querySelector("i.g-check"),t=u.querySelectorAll("li[data-name]");if(e.className.indexOf("checked")!=-1){e.className="g-check";for(var i=0;i<t.length;i++){var n=t[i].querySelector("i.g-check"),a=t[i].getAttribute("data-id");if(n!=null&&n.className.indexOf("checked")!=-1){n.className="g-check";var o=u.querySelector('.b-flex > li[data-id="'+a+'"]');o.parentNode.removeChild(o);f.calcSum()}}}else{e.className="g-check checked";for(var i=0;i<t.length;i++){var n=t[i].querySelector("i.g-check");if(n!=null&&n.className.indexOf("checked")==-1){f.bind._selectFn(t[i])}}}!c&&f.checkDepartment()}},selectUser:function(){var e=u.querySelectorAll("li[data-name]");for(var t=0;t<e.length;t++){e[t].onclick=function(){var e=parseInt(this.getAttribute("data-type"));if(c&&e==1){f.bind.nextDepartmentFn(this)}else{f.bind._selectFn(this)}}}},delectUser:function(){var e=u.querySelectorAll(".b-flex > li");for(var t=0;t<e.length;t++){e[t].onclick=function(){f.bind._bottomDelectFn(this)}}},rightBtn:function(){var e=u.querySelectorAll("li[data-name] div.b-righticon");for(var t=0;t<e.length;t++){e[t].onclick=function(e){e.stopPropagation();var t=this.parentNode.parentNode;t&&f.bind.nextDepartmentFn(t)}}},submitFn:function(){u.querySelector("#submit-btn").onclick=function(){var e={userList:[],deptList:[]};var t=u.querySelectorAll(".b-flex li");for(var i=0;i<t.length;i++){var n=t[i].getAttribute("data-id")||"",a=t[i].getAttribute("data-name")||"",o=t[i].querySelector("img").src||"",r=parseInt(t[i].getAttribute("data-type")),c={id:n,name:a,avatar:o};if(typeof r!="undefined"&&r!=null){if(r==1){e.deptList.push(c)}else if(r==2){e.userList.push(c)}else{console.error(this+"is can not push to resObj")}}}u.parentNode.removeChild(u);s(e)}},goBack:function(){u.querySelector("#complexChoose-goback-btn").onclick=function(){u.parentNode.removeChild(u);d()}}}};var v=function(e,i,n){var a=e.preDep,l=e.currDep;var s='<div id="recipient-main" class="recipient-main"><div class="recipient-main-box">';s+='<div class="navigation-box g-bottomLine"><p>组织架构</p><button id="complexChoose-goback-btn"><i></i>关闭</button></div>';var d="";if(a&&typeof a!="undefined"){var v=a.id||"",g=a.name||"返回上一层";d+='<span id="preDepartment" class="stractive" data-pid="'+v+'">'+g+"</span>&nbsp;&nbsp;&gt;"}if(l&&typeof l!="undefined"){var p=l.name||"";d+="<span>"+p+"</span>"}s+='<p class="structure g-bottomLine">'+d+"</p>";s+='<div class="dropdown-box g-bottomLine"><ul><li><div id="checkall" class="checkall"><i class="g-check"></i>全选</div><ul>';var m=e.department,h=c?"":'<i class="g-check"></i>';for(var y=0;y<m.length;y++){var b=m[y].id,w=m[y].name||"",k=m[y].sum||0;s+='<li data-id="'+b+'" data-name="'+w+'" data-type="1"><div class="a-itemwrap rowheight g-topLine"><div class="b-title b-flex g-ellipsis">'+h+w+'</div><div class="b-righticon ">'+k+"</div></div>"}s+="</ul></li></ul></div>";var _=e.people||"",x=_.length;if(!o&&x>0){s+='<p class="structure g-bottomLine">部门人员</p>';s+='<div class="linkman-box g-topLine"><ul>';for(var S=0;S<x;S++){var b=_[S].id,w=_[S].name||"",A=_[S].avatar||t.avatar({name:w});s+='<li data-id="'+b+'" data-name="'+w+'" data-type="2" class="p-itembox g-bottomLine"><i class="g-check"></i><img src='+A+' class="linkman-box-img"><div class="g-ellipsis p-flex">'+w+"</div></li>"}s+="</ul></div>"}s+="</div>";s+='<div id="select-user" class="select-user"><div class="p-itembox select-userpic"><ul class="b-flex"></ul></div><button id="submit-btn" class="userbutton">确定<span></span></button></div></div>';if(n){var C=document.getElementById("ywork-complex-choose");document.getElementsByTagName("body")[0].removeChild(C)}var L="ywork-complex-choose";r(L,s,function(e){u=document.getElementById(L);f.bind.selectUser();if(i){f._setPrimaryUser(i)}if(a&&typeof a!="undefined"){f.bind.preDepartment()}f.checkAllState();f.bind.checkall();f.bind.delectUser();if(!c){f.bind.rightBtn()}f.bind.submitFn();f.bind.goBack();f.calcSum()})};var g=function(e,i,a){var i=i||false,a=a||false;if(l){var o=bumenRes1;if(e=="b3"){o=bumenRes2}if(e=="c1"){o=bumenRes3}console.log(o);v(o.data,i,a)}else{if(e&&typeof e!="undefined"&&e!=""){var r=n+"&deptId="+e}else{var r=n}t.ajax.get(r).succ(function(e){t.log(r,e);if(typeof e=="undefined"||e==null){t.toast("集合返回失败");return}var n=e.errcode;if(typeof n=="undefined"||n==null||n!=0){t.toast("返回码有误："+n);return}var o=e.data;if(typeof o=="undefined"||o==null){t.toast("返回数据有误");return}v(o,i,a)}).fail(function(e){t.toast();console.error(e)})}};g(a)};t.shareToWechatFriend=function(){var e='<div class="shareToWechatFriend"><div class="shareToWechatFriend-box"><div class="weix-ico">分享给微信好友</div></div><a class="shareToWechatFriend-close" href="javascript: void(0);">关闭</a></div>';r("ywork-jsapi-shareToWechatFriend",e,function(e){var t=document.getElementsByClassName("shareToWechatFriend-close")[0];t.onclick=function(){e.parentNode.removeChild(e)}})};t.clock=function(e){var e=e||{},t=e.list,i=e.selectList||[];if(typeof t=="undefined"||t.length==0){console.log("ywork.clock没有候选值");return}var n='<ul class="y-b-d-body-ul">';for(var a=0;a<t.length;a++){var o=t[a],c=o==0?"约定时间":"提前"+o/1e3/60+"分钟",l=false;if(i instanceof Array&&i.length>0){for(var s=0;s<i.length;s++){if(o==i[s]){l=true;break}}}if(l){n+='<li class="y-b-d-body-li"><input class="g-check"type="checkbox"name="ywork-clock-array" value="'+o+'" checked="checked" onclick="this.checked = !this.checked"><span class="active">'+c+"</span></li>"}else{n+='<li class="y-b-d-body-li"><input class="g-check"type="checkbox"name="ywork-clock-array" value="'+o+'" onclick="this.checked = !this.checked"><span>'+c+"</span></li>"}}n+="</ul>";var d='<div><div class="weui_mask"></div><div class="ywork-bottom-dialog ywork-clock"><div class="ywork-bottom-dialog-head g-topLine"><button class="y-b-d-head-button left">不提醒</button><button class="y-b-d-head-button right">确认</button></div><div class="ywork-bottom-dialog-body ywork-clock-body ">'+n+"</div></div></div>";r("ywork-jsapi-clock",d,function(t){var i=document.getElementsByClassName("y-b-d-body-li"),n=document.getElementsByClassName("y-b-d-head-button right")[0],o=document.getElementsByClassName("y-b-d-head-button left")[0];for(a in i){i[a].onclick=function(){var e=this.childNodes,t;for(var i=0;i<e.length;i++){if(e[i].tagName=="INPUT"){t=e[i];break}}var n=t.checked?"":"active";t.checked=!t.checked;t.nextSibling.className=n}}n.onclick=function(){if(typeof e.succ=="function"){var n=[];for(var a=0;a<i.length;a++){if(i[a].firstChild.checked){var o=parseInt(i[a].firstChild.value);n.push(o)}}e.succ(n)}t.parentNode.removeChild(t)};o.onclick=function(){t.parentNode.removeChild(t);if(typeof e.fail=="function"){e.fail()}}})};t.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)");var i=window.location.search.substr(1).match(t);if(i!=null){return unescape(i[2])}return null};t.isAndroid=function(){var e=navigator.userAgent,t=false;if(e.indexOf("Android")>-1||e.indexOf("Linux")>-1){t=true}return t};t.indexOfArray=function(e){var e=e||{},t=e.array,i=e.value;if(typeof t=="undefined"||typeof i=="undefined"){console.error("传参有误, 请检查");return}for(var n=0;n<t.length;n++){if(t[n]==i){return n}}return-1};t.friendChoose=function(e){var e=e||{},i=e.title||"我的好友",n=e.primaryList||[],a=e.resList,o={isLoadAjax:false,datas:[],pageNo:1,pageSize:20,totalCount:0},c;var l={calcFriendSum:function(){var e=c.querySelector("#friend-submit-btn"),t=c.querySelector("#friend-submit-btn span"),i=c.querySelectorAll(".b-flex > li").length;if(i<=0){e.disabled=true;t.innerHTML=""}else{e.disabled=false;t.innerHTML="("+i+")"}},_addBottomtFriend:function(e,t,i){var n=document.createElement("li");n.setAttribute("data-id",e);n.setAttribute("data-name",t);n.innerHTML='<img src="'+i+'" class="linkman-box-img"><a class="g-add del-icon"></a>';c.querySelector("#selects-friend ul.b-flex").appendChild(n);this.calcFriendSum();this.bind.delectFriend()},_setPrimaryFriend:function(e){if(!e||typeof e=="undefined"){return}var i=c.querySelectorAll("li[data-name]"),n=[];for(var a=0;a<e.length;a++){n.push(e[a].uid)}for(var a=0;a<i.length;a++){var o=i[a].getAttribute("data-id");if(t.indexOfArray({array:n,value:o})!=-1){i[a].querySelector("i.g-check").click()}}e=null},bind:{_selectFn:function(e){var i=e.getAttribute("id"),n=e.querySelector("i.g-check");if(n.className.indexOf("checked")!=-1){n.className="g-check";var a=c.querySelector('.b-flex li[data-id="'+i+'"]');a.parentNode.removeChild(a);l.calcFriendSum()}else{n.className="g-check checked";var o=e.getAttribute("data-name")||"",r=e.getAttribute("data-type");if(e.querySelector("img")==null){var s=t.avatar({name:o})}else{var s=e.querySelector("img").src}l._addBottomtFriend(i,o,s)}},_bottomDelectFn:function(e){var t=e.getAttribute("data-id"),i=c.querySelector('li[data-id="'+t+'"] i.g-check');if(i!=null){i.className="g-check"}e.parentNode.removeChild(e);l.calcFriendSum()},selectFriend:function(){var e=c.querySelectorAll("li[data-name]");for(var t=0;t<e.length;t++){e[t].onclick=function(){l.bind._selectFn(this)}}},delectFriend:function(){var e=c.querySelectorAll(".b-flex > li");for(var t=0;t<e.length;t++){e[t].onclick=function(){l.bind._bottomDelectFn(this)}}},friendSubmitFn:function(){c.querySelector("#friend-submit-btn").onclick=function(){if(typeof e.succ=="function"){var i=[];var n=c.querySelectorAll(".b-flex li");for(var a=0;a<n.length;a++){var o=n[a].getAttribute("id")||"",r=n[a].getAttribute("name")||"",l=n[a].querySelector("img").src||t.avatar({name:r}),s={uid:o,n:r,h:l};i.push(s)}e.succ(i)}c.parentNode.removeChild(c)}},scrollLoad:function(){var e=c.querySelector(".recipient-main-box");var i=function(){if(!o.isLoadAjax){if(e.scrollTop+window.screen.height>document.getElementById("#friend-main-friendul").offsetHeight+80){if(o.pageNo<o.totalPages){o.isLoadAjax=true;setTimeout(function(){o.pageNo++;d()},300)}else{t.toast({text:"没有更多了"});e.removeEventListener("scroll",i)}}}};e.addEventListener("scroll",i)},goBack:function(){c.querySelector("#friend-goback-btn").onclick=function(){if(typeof e.fail=="function"){e.fail(resArr)}c.parentNode.removeChild(c)}}}};var s=function(){var e='<div id="friend-main" class="recipient-main">';e+='<div class="recipient-main-box">';e+='<div class="navigation-box g-bottomLine"><p>'+i+'</p><button id="friend-goback-btn"><i></i>关闭</button></div>';e+='<p class="structure g-topLine">我的好友</p>';e+='<div class="linkman-box g-topLine"><ul id="friend-main-friendul">';var s=o.datas,d=s.length,u="";if(d>0){for(var f=0;f<d;f++){var v=s[f].uid,g=s[f].n||"",p=s[f].h||t.avatar({name:g});u+='<li data-id="'+v+'" data-name="'+g+'" class="p-itembox g-bottomLine"><i class="g-check"></i><img src='+p+' class="linkman-box-img"><div class="g-ellipsis p-flex">'+g+"</div></li>"}e+=u;e+="</ul></div>"}e+="</div>";e+='<div id="selects-friend" class="select-user"><div class="p-itembox select-userpic"><ul class="b-flex"></ul></div><button id="friend-submit-btn" class="userbutton">确定<span></span></button></div></div>';var m="ywork-complex-friendchoose";r(m,e,function(e){c=document.getElementById(m);l.bind.selectFriend();l.bind.delectFriend();if(n){l._setPrimaryFriend(n)}l.calcFriendSum();if(typeof a=="undefined"||a.length==0){l.bind.scrollLoad()}l.bind.friendSubmitFn();l.bind.goBack()})};var d=function(){var e="/yw/lancloud/yue/h5/myfriends?pageNo="+o.pageNo+"&pageSize="+o.pageSize;if(o.totalCount>0){e+="&totalCount="+o.totalCount}if(a&&a!=""&&a.length>0){o.datas=a;s();return}var i=window.debug||false;if(i){if(typeof friendChooseRes=="undefined"){t.toast("请引入JSON再Debug!");return}t.log("debug",friendChooseRes);o=friendChooseRes.data;o.isLoadAjax=false;l.bind.scrollLoad=function(){console.error("debug就不需要滚动加载了")};s()}else{t.ajax(e).get().succ(function(i){console.log(e,i);if(typeof i=="undefined"){t.toast();return}var n=i.errcode;if(typeof n=="undefined"||n!=0){t.toast("请求失败<br>状态码: "+n);return}var a=i.data;if(typeof a=="undefined"||a==""){t.toast("好友数据列表返回失败");return}var r=i.data.datas;if(typeof r=="undefined"||r.length==0){t.toast("暂无好友数据");return}o=a;o.isLoadAjax=false;if(o.pageNo>1){createFriendsHtml()}else{s()}}).fail(function(e){console.error(e);t.hideLoading();t.toast();o.isLoadAjax=false})}};d()};t.wxAuthLogin=function(e){var e=e||{},i=e.debug||false,n=function(t){if(typeof e.succ=="function"){e.succ(t)}},o=function(t){if(typeof e.fail=="function"){e.fail(t)}};url=encodeURIComponent(window.location.href.split("#")[0]);if(e.ajaxURL&&typeof e.ajaxURL!="undefined"&&e.ajaxURL!=""){var r=e.ajaxURL}else{var r="/yw/app/votebiz/getGroupTicket"}if(r.indexOf("?")>-1){r+="&url="+url}else{r+="?url="+url}i&&console.log("wechat签名",r);t.ajax().get(r).succ(function(e){i&&console.log("后台签名数据返回:",e);if(typeof e=="undefined"){o("集合返回失败");return}if(typeof e.errcode=="undefined"||e.errcode!=0){o("返回码有误:"+e.errcode);return}if(typeof e.data=="undefined"){o("返回数据有误");return}var t=e.data.signature;a=e.data.groupTicket;if(typeof t=="undefined"||typeof a=="undefined"){o("返回普通签名数据有误");return}wx.config({debug:false,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["checkJsApi","openEnterpriseChat","openEnterpriseContact","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","translateVoice","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"]});wx.error(function(e){i&&console.error(e);o(e)});wx.ready(function(e){i&&console.log("wx签名成功");n(e)})}).fail(function(e){console.error(r,e);o(e)})};t.wxOpenEnterpriseContact=function(e){var e=e||{},i=e.isSingle?"single":"multi",n=e.departmentIds||[0],o=e.tagIds||[0],r=e.userIds||[],c=e.type||["department","user","tag"],l=e.selectedDepartmentIds||[],s=e.selectedTagIds||[],d=e.selectedUserIds||[],u=function(t){if(typeof e.succ=="function"){e.succ(t)}},f=function(t){if(typeof e.fail=="function"){e.fail(t)}};wx.ready(function(){var e=function(e){if(typeof WeixinJSBridge=="object"&&typeof WeixinJSBridge.invoke=="function"){e()}else{document.attachEvent&&document.attachEvent("WeixinJSBridgeReady",e);document.addEventListener&&document.addEventListener("WeixinJSBridgeReady",e)}};e(function(){WeixinJSBridge.invoke("openEnterpriseContact",{groupId:a.groupId,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,params:{departmentIds:n,tagIds:o,userIds:r,mode:i,type:c,selectedDepartmentIds:l,selectedTagIds:s,selectedUserIds:d}},function(e){if(typeof e=="undefined"||e==null){f({errMsg:"返回数据有误"});return}var i=e.errMsg||e.err_msg;if(typeof i!="undefined"&&i.indexOf("function_not_exist")>0){f({errMsg:"版本过低请升级"});return}if(i.indexOf("openEnterpriseContact:ok")==-1){f({errMsg:i});return}var n=JSON.parse(e.result);t.log("ywork.wxOpenEnterpriseContact通讯录返回",n);var a=n.selectAll,o=n.departmentList||[],r=n.userList||[],c=n.tagList||[];if(!a&&c.length==0){u(n);return}var l="/yw/app/votebiz/getQyWechatUserList",s={selectAll:a,deptIds:[],userIds:[],tagIds:[]};if(o.length>0){for(var d=0;d<o.length;d++){var v=o[d],g=v.id,p=v.name;s.deptIds.push(g)}}if(r.length>0){for(var d=0;d<r.length;d++){var m=r[d],h=m.id,y=m.name;s.userIds.push(h)}}if(c.length>0){for(var d=0;d<c.length;d++){var b=c[d],w=b.id;s.tagIds.push(w)}}t.ajax().post(l,JSON.stringify(s)).succ(function(e){t.log(l,e);if(typeof e=="undefined"||e==null){f({errMsg:"集合返回失败"});return}var i=e.errcode;if(typeof i=="undefined"||i==null){f({errMsg:"系统繁忙"});return}if(i!=0){f({errMsg:"系统繁忙:"+i});return}var a=e.data;if(typeof a=="undefined"||a==null){f({errMsg:"返回数据有误"});return}var o=e.data.userList||[];n.userList=[];n.userList=o;u(n)}).fail(function(e){console.error(e);f({errMsg:"请求后台数据失败"})})})})})};t.setTitle=function(e){var e=e||"";if(i&&i=="dd"){dd.ready(function(){dd.biz.navigation.setTitle({title:e})})}else{document.title=e;if(!t.isAndroid()){var n=document.createElement("iframe");n.style.visibility="hidden";n.setAttribute("src","favicon.ico");var a=function(){setTimeout(function(){n.removeEventListener("load",a);document.body.removeChild(n)},0)};n.addEventListener("load",a);document.body.appendChild(n)}}};t.uploadImage=function(e){var e=e||{},n=e.max||9,a=function(t){if(typeof e.succ=="function"){e.succ(t)}},o=function(t){if(typeof e.fail=="function"){e.fail(t)}};if(i&&i=="dd"){dd.ready(function(){dd.biz.util.uploadImage({multiple:true,max:n,onSuccess:a,onFail:o})})}else if(i&&i=="wx"){wx.ready(function(){var i={localIds:[],serverIds:[]};function a(n){var o=n.pop();wx.uploadImage({localId:o,isShowProgressTips:0,success:function(o){var r=o.serverId;i.serverIds.push(r);if(n.length>0){a(n)}else if(n.length==0){t.hideLoading();if(typeof e.succ=="function"){e.succ(i)}}},fail:function(i){console.log(i);t.hideLoading();if(typeof e.fail=="function"){e.fail(i)}}})}wx.chooseImage({count:n||9,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){var n=e.localIds;for(var o=0;o<n.length;o++){i.localIds.push(n[o])}t.showLoading({text:"图片上传中"});a(n)},fail:function(i){t.hideLoading();if(typeof e.fail=="function"){e.fail(i)}}})})}};t.previewImage=function(e){var e=e||{},t=e.imgURL,n=e.imgList||[],a=function(t){if(typeof e.succ=="function"){e.succ(t)}},o=function(t){if(typeof e.fail=="function"){e.fail(t)}};if(!t||t==""||typeof t=="undefined"){console.error("图片链接有误");return}if(i&&i=="dd"){dd.ready(function(){dd.biz.util.previewImage({urls:n,current:t,onSuccess:a,onFail:o})})}else if(i&&i=="wx"){wx.ready(function(){wx.previewImage({current:t,urls:n,success:a,fail:o})})}};t.getLocation=function(e){var t=e.targetAccuracy||300,n=function(t){if(typeof e.succ=="function"){e.succ(t)}},a=function(t){if(typeof e.fail=="function"){e.fail(t)}};if(i&&i=="dd"){dd.ready(function(){dd.device.geolocation.get({targetAccuracy:t,onSuccess:n,onFail:a})})}else if(i&&i=="wx"){wx.ready(function(){wx.getLocation({type:"gcj02",success:n,fail:a})})}};t.close=function(){if(i&&i=="dd"){dd.ready(function(){dd.biz.navigation.close()})}else if(i&&i=="wx"){wx.ready(function(){wx.closeWindow()})}};t.getNetworkType=function(e){var t=function(t){if(typeof e.succ=="function"){e.succ(t)}},n=function(t){if(typeof e.fail=="function"){e.fail(t)}};if(i&&i=="dd"){dd.ready(function(){dd.device.connection.getNetworkType({onSuccess:t,onFail:n})})}else if(i&&i=="wx"){wx.ready(function(){wx.getNetworkType({success:t})})}};t.share=function(e){var e=e||{},t=e.url,n=e.title||"",a=e.content||"",o=e.imageURL||"",r=function(t){if(typeof e.succ=="function"){e.succ(t)}},c=function(t){if(typeof e.fail=="function"){e.fail(t)}};if(!t||typeof t=="undefined"){console.error("传入链接有误");return}if(i&&i=="dd"){dd.ready(function(){dd.biz.util.share({type:0,url:t,title:n,content:a,image:o,onSuccess:r,onFail:c})})}else if(i&&i=="wx"){wx.ready(function(){wx.onMenuShareTimeline({title:n+a,link:t,imgUrl:o,success:function(){r("wxf")},cancel:c});wx.onMenuShareAppMessage({title:n,desc:a,link:t,imgUrl:o,type:"",dataUrl:"",success:function(){r("wx")},cancel:c});wx.onMenuShareQQ({
title:n,desc:a,link:t,imgUrl:o,success:function(){r("qq")},cancel:c});wx.onMenuShareWeibo({title:n,desc:a,link:t,imgUrl:o,success:function(){r("wb")},cancel:c});wx.onMenuShareQZone({title:n,desc:a,link:t,imgUrl:o,success:function(){r("qqkj")},cancel:c})})}};e.ywork=t})(window);